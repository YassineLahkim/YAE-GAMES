<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aventure au Musée</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
    <style>
        /* Styles CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            height: 100vh;
            font-family: 'Jersey 10', Arial, sans-serif;
            background-color: #1a1a2e; /* Fond de secours */
        }

        .app-container {
            position: relative;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Image de fond */
        .background-image {
            position: absolute;
            width: 100vw;
            height: 100vh;
            background-image: url('img/museeint.png'); /* Remplace avec ton image */
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        /* Personnage et bulle */
        .character-container {
            position: absolute;
            left: 50%;
            bottom: -20px;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: auto; /* Permet le déplacement via JavaScript */
        }

        .speech-bubble {
            position: relative;
            left: 0;
            bottom: 0;
            transform: none;
            margin-bottom: -38px;
            min-width: 60vw;
            max-width: 90vw;
            background: #fff;
            color: #222;
            border-radius: 32px;
            padding: 18px 10px;
            font-size: 2em;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            text-align: center;
            cursor: pointer;
            z-index: 20;
            pointer-events: auto;
            transition: opacity 0.2s;
        }

        .speech-bubble::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 14px 16px 0 16px;
            border-style: solid;
            border-color: #fff transparent transparent transparent;
            filter: drop-shadow(0 3px 3px rgba(0,0,0,0.1));
        }

        /* Animation de disparition du personnage */
        .character-container.disappear {
            animation: slideOutLeft 1s forwards;
        }

        @keyframes slideOutLeft {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(-100vw) scale(0.5);
                opacity: 0;
            }
        }

        /* Ecran de choix des modes */
        .mode-selection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s;
        }

        .mode-selection.show {
            opacity: 1;
            visibility: visible;
        }

        .mode-selection h1 {
            color: #ff5555;
            margin-bottom: 30px;
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .mode-btn {
            background-color: #0f3460;
            color: white;
            border: none;
            padding: 20px 40px;
            margin: 20px 0;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.5em;
            width: 80%; /* Assure une largeur uniforme */
            max-width: 400px; /* Limite la largeur à 400px */
            transition: all 0.3s;
            text-align: center; /* Centrer le texte */
        }

        .mode-btn:hover {
            background-color: #ff5555;
            transform: scale(1.05);
        }

        .mode-description {
            margin: 15px 0;
            color: #ccc;
            font-size: 1.2em;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Image de fond -->
        <div class="background-image"></div>

        <!-- Personnage et bulle de dialogue -->
        <div class="character-container" id="characterContainer">
            <div class="speech-bubble" id="speechBubble"></div>
            <img src="img/personnage peur.png" alt="Personnage" class="character-img" id="characterImg">
        </div>

        <!-- Ecran de choix des modes -->
        <div class="mode-selection" id="modeSelection">
            <h1>Choose Your Mode</h1>
            <button class="mode-btn" id="standardModeBtn">Standard Mode</button>
            <p class="mode-description">Normal difficulty</p>
            <button class="mode-btn" id="accessibleModeBtn">Blind Mode</button>
            <p class="mode-description">Adapted interface</p>
        </div>
    </div>

    <script>
        // === Gestion des dialogues ===
        const dialogues = [
            "The museum is protected by an alarm system... I'll need to disable it if I want to put this painting back in its place without getting caught",
            "To deactivate the keypad, all you need to do is follow the instructions, but each step gets faster and faster.",
            "Help me enter the code and disable the alarm !"
        ];

        let dialogueIndex = 0;
        const bubble = document.getElementById('speechBubble');
        const characterContainer = document.getElementById('characterContainer');
        const modeSelection = document.getElementById('modeSelection');
        let typingSpeed = 40; // Vitesse d'écriture
        let typingTimeouts = [];
        let isTyping = false;

        function clearTyping() {
            typingTimeouts.forEach(timeout => clearTimeout(timeout));
            typingTimeouts = [];
            isTyping = false;
        }

        function typeWriter(text, callback) {
            bubble.textContent = "";
            isTyping = true;
            for (let i = 0; i < text.length; i++) {
                typingTimeouts.push(setTimeout(() => {
                    bubble.textContent += text.charAt(i);
                    if (i === text.length - 1) {
                        isTyping = false;
                        if (callback) callback();
                    }
                }, typingSpeed * i));
            }
        }

        function showDialogue(index) {
            clearTyping();
            if (index < dialogues.length) {
                bubble.style.opacity = 1;
                typeWriter(dialogues[index]);
            } else {
                bubble.style.opacity = 0;
                // Faire glisser le personnage vers la gauche après le dernier dialogue
                characterContainer.classList.add('disappear');

                // Afficher l'écran de sélection des modes après la disparition
                setTimeout(() => {
                    modeSelection.classList.add('show');
                }, 1000); // Attendre la fin de l'animation de disparition
            }
        }

        function nextDialogue() {
            if (isTyping) {
                clearTyping();
                bubble.textContent = dialogues[dialogueIndex];
                isTyping = false;
            } else {
                dialogueIndex++;
                showDialogue(dialogueIndex);
            }
        }

        // Avance le dialogue au clic
        document.addEventListener('click', function (e) {
            nextDialogue();
        });

        // Premier dialogue
        showDialogue(0);

        // === Menu de sélection de mode ===
        document.getElementById('standardModeBtn').addEventListener('click', () => {
            window.location.href = 'standardmode.html'; // Redirection vers la page mode standard
        });

        document.getElementById('accessibleModeBtn').addEventListener('click', () => {
            window.location.href = 'blindModePage.html'; // Redirection vers la page mode malvoyant
        });

        // Déplacement du personnage avec les flèches du clavier
        document.addEventListener('keydown', function(e) {
            const characterContainer = document.getElementById('characterContainer');
            const step = 10; // Distance du mouvement par pression de touche

            let currentTop = parseInt(window.getComputedStyle(characterContainer).top) || 0;
            let currentLeft = parseInt(window.getComputedStyle(characterContainer).left) || 0;

            switch(e.key) {
                case 'ArrowUp':
                    characterContainer.style.top = `${currentTop - step}px`;
                    break;
                case 'ArrowDown':
                    characterContainer.style.top = `${currentTop + step}px`;
                    break;
                case 'ArrowLeft':
                    characterContainer.style.left = `${currentLeft - step}px`;
                    break;
                case 'ArrowRight':
                    characterContainer.style.left = `${currentLeft + step}px`;
                    break;
            }
        });
    </script>
</body>
</html>
